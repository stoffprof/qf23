
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Numerical optimization &#8212; Quant Finance in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/admonitions.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/.ipynb_checkpoints/admonitions-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="_static/.ipynb_checkpoints/custom-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"cov": "\\operatorname{Cov}", "var": "\\operatorname{Var}", "N": "\\mathcal{N}", "E": "\\mathbb{E}", "P": "\\mathbb{P}", "R": "\\mathbb{R}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://stoffprof.github.io/qf23/05c Numerical optimization.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notation" href="notation.html" />
    <link rel="prev" title="The efficient frontier" href="05b%20Efficient%20portfolios.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/qf.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Quant Finance in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preliminaries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01a%20math.html">
   Math background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01b%20returns.html">
   Asset returns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01c%20prices.html">
   A model of prices
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="probability.html">
   Probability
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02a%20MSE.html">
     Prediction: First look
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02b%20Probability%20theory.html">
     Probability theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02d%20Pseudorandom%20number%20generation.html">
     Pseudorandom number generation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02c%20Distributions.html">
     Probability distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02e%20Covariance.html">
     Covariance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02f%20Estimation.html">
     Parameter estimation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="regression.html">
   Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04a%20Regression%20theory.html">
     Linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04b%20Regression%20applications.html">
     Implementing regressions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Factors
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06%20Calculating%20beta.html">
   Factor regressions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Portfolio optimization
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="05a%20Diversification.html">
   Diversification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05b%20Efficient%20portfolios.html">
   The efficient frontier
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Numerical optimization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="notation.html">
   Notation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sources.html">
   Additional sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/05c Numerical optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-efficient-frontier">
   The efficient frontier
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-gmv-portfolio">
     The GMV portfolio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-tangency-portfolio">
     The tangency portfolio
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-the-constraints">
   Changing the constraints
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#short-sale-constraints">
     Short-sale constraints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variations">
   Variations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utility-maximization">
   Utility maximization
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Numerical optimization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-efficient-frontier">
   The efficient frontier
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-gmv-portfolio">
     The GMV portfolio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-tangency-portfolio">
     The tangency portfolio
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-the-constraints">
   Changing the constraints
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#short-sale-constraints">
     Short-sale constraints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variations">
   Variations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utility-maximization">
   Utility maximization
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="numerical-optimization">
<h1>Numerical optimization<a class="headerlink" href="#numerical-optimization" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>Rather than using analytical methods to solve the portfolio optimization problem, we can use an algorithm to find the solution numerically.</p>
<p>We’ll begin by reading in the same returns data we used in the previous section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/stoffprof/qf22/main/data/MSCI_returns.csv&#39;</span><span class="p">,</span>
                   <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The calculation below shows that, across our 34 countries, the average monthly return is 0.61%, or 61 basis points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    34.000000
mean      0.006123
std       0.003035
min       0.000090
25%       0.004030
50%       0.005621
75%       0.007787
max       0.013330
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>When working with numerical optimization algorithms, it is important that the values being used in a function are not too small. If they are, the rounding error in calculations may be nonneglible relative to the magnitude of the values in the function, and the error can start to swamp the actual information.</p>
<p>An easy solution in these data is simply to multiply by 100, which converts the units to percentage points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert returns to percent</span>
<span class="n">rets</span> <span class="o">=</span> <span class="n">rets</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store parameter estimates in numpy arrays</span>

<span class="n">μ</span> <span class="o">=</span> <span class="n">rets</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">Σ</span> <span class="o">=</span> <span class="n">rets</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an equal-weights vector of N elements</span>
<span class="n">ewgts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mvs</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculate mean, volatility, and Sharpe Ratio for a given set of portfolio weights&#39;&#39;&#39;</span>
    <span class="n">μp</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">μ</span>
    <span class="n">σp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Σ</span> <span class="o">@</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">μp</span><span class="p">,</span> <span class="n">σp</span><span class="p">,</span> <span class="n">μp</span><span class="o">/</span><span class="n">σp</span>
</pre></div>
</div>
</div>
</div>
<p>The equal-weighted portfolio has a return of 0.6%, volatility of about 5.3%, and a Sharpe ratio of 0.11:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mvs</span><span class="p">(</span><span class="n">ewgts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.6122722634350777, 5.252488549531674, 0.11656803392549414)
</pre></div>
</div>
</div>
</div>
<p>To implement numerical optimization, we start as before with the minimization problem:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{aligned}
\min_{\omega} \quad &amp; \boldsymbol{\omega}'\boldsymbol{\Sigma}\boldsymbol{\omega} \\
\textrm{subject to} \quad &amp; \boldsymbol{\omega}'\boldsymbol{\mu} = \mu_p\\
  &amp;\boldsymbol{\omega}'\mathbf{1} = 1.
\end{aligned}
\end{equation*}\]</div>
<p>Suppose we want an efficient portfolio with an expected return of 1.2% (per month). Then the <em>target return</em> is</p>
<div class="math notranslate nohighlight">
\[\mu_p = 1.2.\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># target return</span>
<span class="n">tret</span> <span class="o">=</span> <span class="mf">1.2</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the minimization algorithms in <code class="docutils literal notranslate"><span class="pre">scipy</span></code> to find us an efficient portoflio (that is, the one that achieves the target return and has minimum variance). To do so, we need to pass the function we want to minimize and the constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">sco</span>
</pre></div>
</div>
</div>
</div>
<p>Each constraint is entered as dictionary. Since we have two constraints, we’ll pass a list of two dictionaries. Each dictionary has two keys: <code class="docutils literal notranslate"><span class="pre">type</span></code> indicating whether it is an equality or inequality constraint; and <code class="docutils literal notranslate"><span class="pre">fun</span></code> that encodes a function representing the constraint. The function must return zero when the constraint is satisfied.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cons</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># expected return equals target return</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">mvs</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tret</span><span class="p">},</span>  
    
    <span class="c1"># weights sum to one</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll define a function that gives the variance of a portfolio given its weights.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">portvar</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mvs</span><span class="p">(</span><span class="n">weights</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>We’re ready to call the optimization algorithm. We just pass the function to minimize, a starting point for the algorithm (a set of initial weights), and the name of the algorithm we want to use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span>             <span class="c1"># function to minimize</span>
                 <span class="n">ewgts</span><span class="p">,</span>               <span class="c1"># starting point for variables (weights)</span>
                 <span class="n">constraints</span> <span class="o">=</span> <span class="n">cons</span><span class="p">,</span>  <span class="c1"># constraints</span>
                 <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;SLSQP&#39;</span>     <span class="c1"># minimization algorithm (sequential quadratic programming)</span>
                 <span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<p>The result from calling the minizer is a <code class="docutils literal notranslate"><span class="pre">scipy</span></code> object that contains information about the solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 14.488233882505
     jac: array([30.65881503, 20.61089897, 19.10940313, 18.52489269, 30.5522722 ,
       21.48034894, 22.53938985, 25.6682148 , 24.63789546, 20.87520409,
       20.87920845, 13.91243613, 23.50749016, 22.87833345, 17.69702303,
       17.62104511, 15.56044507, 23.46878147, 18.82496107, 27.7703898 ,
       22.76413059, 18.48754823, 20.93599355, 20.59116209, 15.62072313,
       20.03822172, 20.01884162, 24.39380693, 23.69393444, 20.66437578,
       21.05732024, 25.56303132, 18.15012705, 23.69794881])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 1496
     nit: 41
    njev: 41
  status: 0
 success: True
       x: array([ 0.00132769,  0.12571799, -0.00382969, -0.1630436 , -0.0137406 ,
       -0.13110013,  0.11427281,  0.46175985, -0.01824726,  0.10499812,
       -0.30231419, -0.05916472,  0.05249472, -0.02142315, -0.15179106,
        0.00259726,  0.00623929, -0.00894754,  0.08640203,  0.04159314,
        0.09443393, -0.01217702, -0.1126306 ,  0.0022378 , -0.06153882,
       -0.12459507, -0.03384741, -0.11621803,  0.49676866,  0.04060761,
       -0.06686027,  0.01878741, -0.1333961 ,  0.88462696])
</pre></div>
</div>
</div>
</div>
<p>We see the value of the function at its minimum, <code class="docutils literal notranslate"><span class="pre">fun</span></code>. In our case, this is the value of the minimized variance. The <code class="docutils literal notranslate"><span class="pre">message</span></code> indicates that the optimization algorithm worked.</p>
<p>The minimization algorithm returns the <span class="math notranslate nohighlight">\(x\)</span> values for the minimized function—in this case, the weights of the efficient portfolio—in the <code class="docutils literal notranslate"><span class="pre">x</span></code> property of the results object. We can pass that to our <code class="docutils literal notranslate"><span class="pre">mvs()</span></code> function to get the expected return, variance, and Sharpe ratio of this portfolio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mvs</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.1999999999955289, 3.806341272469535, 0.3152633760600701)
</pre></div>
</div>
</div>
</div>
<p>Not surprisingly, the expected return of the portfolio is 1.2%; it should be, since one of the constraints we passed the optimizer was that this was the target return. The volatility is <span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">3.806</span></code></span>, which matches the square-root of the variance.</p>
<p>We can compare this value to the analytical result from equation <a class="reference internal" href="05b%20Efficient%20portfolios.html#equation-eff-var">(14)</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>

<span class="n">Σinv</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">Σ</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">μ</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Σinv</span> <span class="o">@</span> <span class="n">μ</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">μ</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Σinv</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Σinv</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># variance equation</span>
<span class="p">(</span><span class="n">C</span> <span class="o">*</span> <span class="n">tret</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">tret</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">C</span> <span class="o">-</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14.488233878599347
</pre></div>
</div>
</div>
</div>
<p>This value from the analytical solution is almost identical to the variance calculated with <code class="docutils literal notranslate"><span class="pre">scipy</span></code> above.</p>
<p>We can also compare the weights from the analytical solution to those found by <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># weights of efficient portfolio using analytical solution</span>

<span class="n">wgts_analytical</span> <span class="o">=</span> <span class="n">Σinv</span> <span class="o">@</span> <span class="p">((</span><span class="n">C</span><span class="o">*</span><span class="n">tret</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">μ</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="o">*</span><span class="n">tret</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="o">-</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">wgts_analytical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.00132811,  0.12573364, -0.00383124, -0.16303883, -0.01374111,
       -0.13110422,  0.11427084,  0.46176078, -0.01824743,  0.1049871 ,
       -0.30231779, -0.0591645 ,  0.05249618, -0.02142276, -0.15179151,
        0.002599  ,  0.00624016, -0.0089481 ,  0.08640256,  0.04159404,
        0.09443635, -0.01218742, -0.11263147,  0.00223792, -0.06153245,
       -0.12459565, -0.0338511 , -0.11621205,  0.49677069,  0.04060859,
       -0.06686116,  0.01878751, -0.1333973 ,  0.8846226 ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Difference between analytical weights and scipy weights</span>
<span class="n">wgts_analytical</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 4.26314183e-07,  1.56478938e-05, -1.55047522e-06,  4.77347618e-06,
       -5.07803894e-07, -4.09693523e-06, -1.96779907e-06,  9.32467859e-07,
       -1.67994892e-07, -1.10141007e-05, -3.60049427e-06,  2.14710580e-07,
        1.46846666e-06,  3.95246703e-07, -4.49480285e-07,  1.73991719e-06,
        8.70052626e-07, -5.56454157e-07,  5.29804410e-07,  8.98017043e-07,
        2.41087085e-06, -1.03974005e-05, -8.63982474e-07,  1.21225811e-07,
        6.37310126e-06, -5.81995552e-07, -3.69434824e-06,  5.98079200e-06,
        2.02865161e-06,  9.77503471e-07, -8.85367082e-07,  1.06265035e-07,
       -1.20089931e-06, -4.35924637e-06])
</pre></div>
</div>
</div>
</div>
<p>Clearly, the efficient portfolios found by each method are essentially the same.</p>
<section id="the-efficient-frontier">
<h2>The efficient frontier<a class="headerlink" href="#the-efficient-frontier" title="Permalink to this headline">#</a></h2>
<p>To find the efficient frontier, we can sweep across values of <span class="math notranslate nohighlight">\(\mu_p\)</span>, and for each one find the portfolio with minimum variance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># target returns</span>
<span class="n">trets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tvols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tret</span> <span class="ow">in</span> <span class="n">trets</span><span class="p">:</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">mvs</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tret</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
    <span class="n">tvol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">])</span>
    <span class="n">tvols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tvol</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># initial portfolios</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Σ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]),</span> <span class="n">μ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    
<span class="c1"># Efficient frontier</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvols</span><span class="p">,</span> <span class="n">trets</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">)</span>

<span class="c1"># xmax = np.sqrt(np.diag(Σ)).max() * 1.1</span>
<span class="c1"># ymax = μ.max() * 1.1</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05c Numerical optimization_43_0.png" src="_images/05c Numerical optimization_43_0.png" />
</div>
</div>
<section id="the-gmv-portfolio">
<h3>The GMV portfolio<a class="headerlink" href="#the-gmv-portfolio" title="Permalink to this headline">#</a></h3>
<p>Analytically, we found the GMV by minimizing the function for the variance of an efficient portfolio. We set the derivative equal to zero, and solved.</p>
<p>Working numerically, we accomplish the same thing by specifying a new problem, although without a constraint to achieve any particular target return. That is, the problem is simply to find the minimum variance of <em>any</em> feasible portfolio, regardless of its expected return.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{aligned}
\min_{\omega} \quad &amp; \boldsymbol{\omega}'\boldsymbol{\Sigma}\boldsymbol{\omega} \\
\textrm{subject to} \quad &amp; \boldsymbol{\omega}'\mathbf{1} = 1.
\end{aligned}
\end{equation*}\]</div>
<p>To implement this, all we have to do is redefine the constraint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cons_gmv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">gmv</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons_gmv</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gmv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: 9.952993145000868
     jac: array([19.90605474, 19.90584934, 19.90542924, 19.90633738, 19.90595698,
       19.90492511, 19.90632403, 19.90502429, 19.90598547, 19.90626085,
       19.90607488, 19.90585184, 19.90569198, 19.90563393, 19.90509987,
       19.90679085, 19.90609407, 19.90573311, 19.90591085, 19.90563977,
       19.90666997, 19.90623808, 19.90586269, 19.90584445, 19.90538716,
       19.90635562, 19.90580893, 19.90582657, 19.90633547, 19.90588665,
       19.90594077, 19.90605283, 19.9061873 , 19.90577269])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 1281
     nit: 35
    njev: 35
  status: 0
 success: True
       x: array([-0.01409767,  0.07838234, -0.08697059,  0.00979833, -0.04945914,
       -0.03428682,  0.1318209 ,  0.16377405, -0.04548706, -0.01265083,
       -0.1192402 , -0.01924829, -0.0126025 , -0.02777548, -0.08397341,
        0.09241326,  0.18597078, -0.05696337,  0.12770124, -0.00443689,
       -0.12891989,  0.06914165, -0.09933991,  0.03218009,  0.13916737,
       -0.0985886 , -0.1118702 , -0.15856988,  0.22670899,  0.05843541,
       -0.06855116,  0.00109853,  0.27557963,  0.64085931])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mvs</span><span class="p">(</span><span class="n">gmv</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.4828601401892585, 3.154836468820669, 0.15305393638034107)
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-tangency-portfolio">
<h3>The tangency portfolio<a class="headerlink" href="#the-tangency-portfolio" title="Permalink to this headline">#</a></h3>
<p>We previously saw that the Tangency portfolio has the maximum possible Sharpe ratio of any portfolio. The problem is therefore</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{aligned}
\max_{\omega} \quad &amp; \frac{\boldsymbol{\omega}'\boldsymbol{\mu}}{\sqrt{\boldsymbol{\omega}'\boldsymbol{\Sigma}\boldsymbol{\omega}}}\\
\textrm{subject to} \quad &amp; \boldsymbol{\omega}'\mathbf{1} = 1.
\end{aligned}
\end{equation*}\]</div>
<p>The only complication is that <code class="docutils literal notranslate"><span class="pre">scipy</span></code> provides a method to minimize a function, but not maximize one. Not to worry: if we simply multiply our function by minus one and find the maximum, we will have found the minimum of the original function. (Maximizing <span class="math notranslate nohighlight">\(f(x) = -x^2\)</span> is the same as minimizing <span class="math notranslate nohighlight">\(f(x) = x^2\)</span>. Either way the answer is <span class="math notranslate nohighlight">\(x=0\)</span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">neg_sharpe</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">mvs</span><span class="p">(</span><span class="n">weights</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tng</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">neg_sharpe</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span>
                   <span class="n">constraints</span><span class="o">=</span><span class="n">cons_gmv</span><span class="p">,</span>  <span class="c1"># note same constraints as GMV</span>
                   <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tng</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     fun: -0.3698955472554881
     jac: array([-2.50663608e-04, -2.26631761e-04, -3.37943435e-04, -2.08642334e-04,
       -8.44597816e-05, -2.31623650e-04, -2.81330198e-04, -8.93250108e-05,
       -3.15103680e-04, -3.58577818e-04, -2.13637948e-04, -2.23852694e-04,
       -7.23637640e-05, -3.23552638e-04,  2.95415521e-06, -2.05796212e-04,
       -2.46837735e-05, -4.00818884e-04,  6.32368028e-05, -1.05340034e-04,
       -4.63947654e-05, -8.78199935e-05, -2.57339329e-04, -1.11591071e-04,
       -4.43764031e-04, -2.89089978e-04, -1.82636082e-04, -2.13306397e-04,
       -2.84664333e-04, -7.04862177e-05, -3.26916575e-04, -1.23254955e-04,
       -2.18957663e-04, -1.36207789e-04])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 1261
     nit: 36
    njev: 36
  status: 0
 success: True
       x: array([ 3.62232057e-02,  2.32556668e-01,  1.83680673e-01, -5.54333151e-01,
        6.71535384e-02, -3.51180320e-01,  7.43419525e-02,  1.13701518e+00,
        4.27211703e-02,  3.66182421e-01, -7.15878914e-01, -1.49148069e-01,
        2.02001456e-01, -6.94226454e-03, -3.04457769e-01, -2.00263551e-01,
       -3.99740696e-01,  9.86348044e-02, -6.15203291e-03,  1.46195065e-01,
        6.05584884e-01, -1.95547134e-01, -1.42065901e-01, -6.55036825e-02,
       -5.18165369e-01, -1.85949108e-01,  1.44691263e-01, -2.11056511e-02,
        1.10551534e+00,  5.17513352e-04, -6.33602320e-02,  5.90817186e-02,
       -1.06010876e+00,  1.43780575e+00])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mvs</span><span class="p">(</span><span class="n">tng</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.824373744794745, 7.6355981188493205, 0.3698955472554881)
</pre></div>
</div>
</div>
</div>
<p>The Sharpe ratio of the tangency portfolio is about <span class="pasted-inline"><code class="output text_plain docutils literal notranslate"><span class="pre">2.4</span></code></span> times that of the GMV portfolio.</p>
</section>
</section>
<section id="changing-the-constraints">
<h2>Changing the constraints<a class="headerlink" href="#changing-the-constraints" title="Permalink to this headline">#</a></h2>
<p>So far, we used the minimization algorithm to get an answer that we already know how to find using analytical methods. So what is the benefit of using a numerical solver?</p>
<p>Numerical solutions can be found for problems that are much harder or even impossible to solve with analytical techniques.</p>
<section id="short-sale-constraints">
<h3>Short-sale constraints<a class="headerlink" href="#short-sale-constraints" title="Permalink to this headline">#</a></h3>
<p>For example, many investors, including mutual funds, cannot engage in short selling. That is, they cannot hold a negative position in any asset.</p>
<p>We can represent their problem by adding one additional set of constraints to the problem that requires that all values of <span class="math notranslate nohighlight">\(\omega\)</span> must be nonnegative.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{aligned}
\min_{\omega} \quad &amp; \boldsymbol{\omega}'\boldsymbol{\Sigma}\boldsymbol{\omega} \\
\textrm{subjct to} \quad &amp; \boldsymbol{\omega}'\boldsymbol{\mu} = \mu_p,\\
  &amp;\boldsymbol{\omega}'\mathbf{1} = 1, \\
  &amp;\omega_i\geq 0 \quad \forall i.
\end{aligned}
\end{equation*}\]</div>
<p>This problem is <em>much</em> harder to solve analytically, but trivial for the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> algorithm. We simply add additional constraints to the problem.</p>
<p>The constraint that <span class="math notranslate nohighlight">\(\omega_i &gt; 0\)</span> is actually a special type of constraint called a <em>boundary</em>. These are easiest to implement by passing a list of upper- and lower-bounds to the algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>With a long-only portfolio there is no way to construct a portfolio with a return that is less than that of the lowest-return asset, or above that of the highest-return asset, so we have to choose a target return in that range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tret</span> <span class="o">=</span> <span class="mf">1.2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">tret</span><span class="o">&lt;</span><span class="nb">max</span><span class="p">(</span><span class="n">μ</span><span class="p">),</span> <span class="s1">&#39;Target return is infeasible&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cons</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># expected return equals target return</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">mvs</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tret</span><span class="p">},</span>  
    
    <span class="c1"># weights sum to one</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Optimization terminated successfully&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2.90163153e-01, 2.03552401e-12, 0.00000000e+00, 2.92133123e-12,
       2.74925902e-01, 5.20420646e-12, 5.47852442e-12, 1.88805646e-01,
       0.00000000e+00, 6.92250187e-13, 0.00000000e+00, 0.00000000e+00,
       1.46255645e-12, 0.00000000e+00, 3.87583444e-12, 0.00000000e+00,
       1.18300692e-11, 0.00000000e+00, 4.49675572e-12, 2.46105300e-01,
       3.23751147e-12, 4.37396607e-12, 0.00000000e+00, 1.27690212e-12,
       1.15783943e-12, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       1.15298750e-11, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       7.29360140e-12, 1.33413977e-11])
</pre></div>
</div>
</div>
</div>
<p>The portfolio has the desired expected return of 6%, volatility of about 14%, and a Sharpe ratio of 0.43.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mvs</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.2000000000537399, 8.043573775560901, 0.1491874176252036)
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Check your understanding</p>
<p>The Sharpe ratio of this minimum-variance portfolio is significantly less than what we found above when we didn’t impose short-sale constraints. Why?</p>
</div>
<p>Many of the weight in the portfolio are now zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">rets</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">w</span><span class="p">[</span><span class="n">w</span><span class="o">&gt;</span><span class="mf">0.0001</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Argentina    0.290163
Brazil       0.274926
Mexico       0.246105
Denmark      0.188806
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># initial portfolios</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Σ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]),</span> <span class="n">μ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    
<span class="c1"># EW portfolio</span>
<span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">mvs</span><span class="p">(</span><span class="n">ewgts</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;b*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1">################################################################</span>
<span class="c1"># Unconstrained</span>
<span class="c1">################################################################</span>

<span class="c1"># Efficient frontier</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvols</span><span class="p">,</span> <span class="n">trets</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unconstrained&#39;</span><span class="p">)</span>

<span class="c1"># GMV</span>
<span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">mvs</span><span class="p">(</span><span class="n">gmv</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># Tangency</span>
<span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">mvs</span><span class="p">(</span><span class="n">tng</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;g*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1">################################################################</span>
<span class="c1"># Long-only portfolios</span>
<span class="c1">################################################################</span>

<span class="c1"># Efficient frontier</span>
<span class="n">tvols_c</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trets_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">μ</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">μ</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tret</span> <span class="ow">in</span> <span class="n">trets_c</span><span class="p">:</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">mvs</span><span class="p">(</span><span class="n">w</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tret</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
    <span class="n">tvol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">])</span>
    <span class="n">tvols_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tvol</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tvols_c</span><span class="p">,</span> <span class="n">trets_c</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Constrained&#39;</span><span class="p">)</span>

<span class="c1"># GMV</span>
<span class="n">gmv_c</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portvar</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons_gmv</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">mvs</span><span class="p">(</span><span class="n">gmv_c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># Tangency</span>
<span class="n">tng_c</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">neg_sharpe</span><span class="p">,</span> <span class="n">ewgts</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons_gmv</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">mvs</span><span class="p">(</span><span class="n">tng_c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Volatility&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Expected return&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05c Numerical optimization_77_0.png" src="_images/05c Numerical optimization_77_0.png" />
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Suppose a hedge fund can use leverage (that is, borrow money) to buy stocks. This leverage allows the fund to have 200% of its capital invested in its portfolio.  Also, it can short stocks, but only up to a weight of –20% in each stock; similarly it cannot have a weight of more than +50% in any stock. What are the expected return, volatility, and Sharpe ratio of its this fund’s tangency portfoio?</p>
</div>
</section>
</section>
<section id="variations">
<h2>Variations<a class="headerlink" href="#variations" title="Permalink to this headline">#</a></h2>
<p>There are numerous ways that we might want to constrain the optimization problem:</p>
<ul class="simple">
<li><p>We might want a <em>sparse</em> solution, where we only select a small number of assets to hold.</p></li>
<li><p>Alternatively, we might want to require a certain number of assets in the portfolio, or a minimum holding in every asset.</p></li>
<li><p>We could add a cost of shorting.</p></li>
<li><p>We could include <em>transaction costs</em> that reflect the cost of adjusting our portfolio from its current holdings. An often-used model if transaction cost is, for a given trade size <span class="math notranslate nohighlight">\(x\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[C(x) = a|x| + b\sigma \frac{|x|^{3/2}}{V^{3/2}} + cx,\]</div>
<p>where <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span> are parameters, <span class="math notranslate nohighlight">\(\sigma\)</span> is volatility, and <span class="math notranslate nohighlight">\(V\)</span> is the volume of trading in the asset. <span class="math notranslate nohighlight">\(a\)</span> reflects the bid–ask spread. See, for example, <a class="reference external" href="http://dx.doi.org/10.1561/2400000023">Boyd et al. (2017).</a></p>
</section>
<section id="utility-maximization">
<h2>Utility maximization<a class="headerlink" href="#utility-maximization" title="Permalink to this headline">#</a></h2>
<img src="https://host.kelley.iu.edu/nstoffma/da/MV-utility.gif">
Source: Ang (2014), Figure 3.8</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="05b%20Efficient%20portfolios.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The efficient frontier</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="notation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    <div class="extra_footer">
      &copy; 2023 <a href="https://stoffprof.github.io">Noah Stoffman</a>. Version 0.23.03.
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>