
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Markov Switching model &#8212; Quant Finance in Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/admonitions.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/.ipynb_checkpoints/admonitions-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="_static/.ipynb_checkpoints/custom-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"cov": "\\operatorname{Cov}", "var": "\\operatorname{Var}", "N": "\\mathcal{N}", "E": "\\mathbb{E}", "P": "\\mathbb{P}", "R": "\\mathbb{R}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://stoffprof.github.io/qf23/07b Markov switching model.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Volatility modeling" href="08%20Volatility%20modeling.html" />
    <link rel="prev" title="Applications" href="07aa%20Applications.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/qf.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Quant Finance in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preliminaries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01a%20math.html">
   Math background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01b%20returns.html">
   Asset returns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01c%20prices.html">
   A model of prices
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="probability.html">
   Probability
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="02a%20MSE.html">
     Prediction: First look
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02b%20Probability%20theory.html">
     Probability theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02d%20Pseudorandom%20number%20generation.html">
     Pseudorandom number generation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02c%20Distributions.html">
     Probability distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02e%20Covariance.html">
     Covariance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02f%20Estimation.html">
     Parameter estimation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="regression.html">
   Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="04a%20Regression%20theory.html">
     Linear regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04b%20Regression%20applications.html">
     Implementing regressions
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Factors
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06%20Calculating%20beta.html">
   Factor regressions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Portfolio optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="05a%20Diversification.html">
   Diversification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05b%20Efficient%20portfolios.html">
   The efficient frontier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05c%20Numerical%20optimization.html">
   Numerical optimization
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time series modeling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="07a%20Time%20series%20analysis.html">
   Time series models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07aa%20Applications.html">
   Applications
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Markov Switching model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08%20Volatility%20modeling.html">
   Volatility modeling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="notation.html">
   Notation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sources.html">
   Additional sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/07b Markov switching model.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gdp-growth">
   GDP growth
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-great-moderation">
   The Great Moderation
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Markov Switching model</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gdp-growth">
   GDP growth
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-great-moderation">
   The Great Moderation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">statsmodels.tsa.ar_model</span> <span class="kn">import</span> <span class="n">AutoReg</span><span class="p">,</span> <span class="n">ar_select_order</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.regime_switching.markov_autoregression</span> <span class="kn">import</span> <span class="n">MarkovAutoregression</span>

<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">pdr</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="markov-switching-model">
<h1>Markov Switching model<a class="headerlink" href="#markov-switching-model" title="Permalink to this headline">#</a></h1>
<p>A times series <span class="math notranslate nohighlight">\({x_t}\)</span> follows a Markov switching autoregressive model if</p>
<div class="math notranslate nohighlight">
\[\begin{split}x_t = \left\{\begin{matrix}
c_0 + \sum_{i=1}^p \phi_{0,i} x_{t-i} + \varepsilon_{0t} \quad \text{if } s_t=0,\\ 
c_1 + \sum_{i=1}^p \phi_{1,i} x_{t-i} + \varepsilon_{1t} \quad \text{if } s_t=1 ,
\end{matrix}\right.
\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(\varepsilon_{it}\sim N(0,\sigma_i^2)\)</span>.</p>
<p>The <em>state variable</em> <span class="math notranslate nohighlight">\(s_t\)</span> is a <em>Markov chain</em> with transition probabilities</p>
<div class="math notranslate nohighlight">
\[\begin{split}P(S_t=s_t|S_{t-1}=s_{t-1})=\begin{pmatrix}
1-\eta_0 &amp; \eta_0 \\ 
\eta_1 &amp; 1-\eta_1
\end{pmatrix}.\end{split}\]</div>
<p>In words, this says that the probability of transitioning from state 0 to state 1 is <span class="math notranslate nohighlight">\(\eta_0\)</span>, and the probability of transitioning from state 1 to state 0 is <span class="math notranslate nohighlight">\(\eta_1\)</span>. These <span class="math notranslate nohighlight">\(\eta\)</span>s are additional parameters that we must estimate from the data. Note also that the rows of the transition matrix sum to one.</p>
<section id="gdp-growth">
<h2>GDP growth<a class="headerlink" href="#gdp-growth" title="Permalink to this headline">#</a></h2>
<p>We’ll use the Real Gross Domestic Product series (in Billions of Chained 2012 Dollars, Seasonally Adjusted)</p>
<p><a class="reference external" href="https://fred.stlouisfed.org/series/GDPC1">https://fred.stlouisfed.org/series/GDPC1</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_fred</span><span class="p">(</span><span class="s1">&#39;GDPC1&#39;</span><span class="p">,</span> <span class="mi">1947</span><span class="p">)</span>

<span class="c1"># set index frequency to quarterly</span>
<span class="n">gdp</span> <span class="o">=</span> <span class="n">gdp</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;QS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Billions of 2012 dollars&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07b Markov switching model_8_0.png" src="_images/07b Markov switching model_8_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gdp</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;GDP Growth&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07b Markov switching model_10_0.png" src="_images/07b Markov switching model_10_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># restrict series to pre-COVID period</span>
<span class="n">gdpgr</span> <span class="o">=</span> <span class="n">gdpgr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;2019&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDPC1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>291.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.007714</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.009283</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.026297</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.003060</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.007600</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.012440</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.038548</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modsel</span> <span class="o">=</span> <span class="n">ar_select_order</span><span class="p">(</span><span class="n">gdpgr</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">old_names</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="s1">&#39;aic&#39;</span><span class="p">)</span>

<span class="n">modsel</span><span class="o">.</span><span class="n">ar_lags</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr_ar3</span> <span class="o">=</span> <span class="n">AutoReg</span><span class="p">(</span><span class="n">gdpgr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">old_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdpgr_ar3</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            AutoReg Model Results                             
==============================================================================
Dep. Variable:                  GDPC1   No. Observations:                  291
Model:                     AutoReg(3)   Log Likelihood                 963.935
Method:               Conditional MLE   S.D. of innovations              0.009
Date:                Mon, 04 Apr 2022   AIC                          -1917.870
Time:                        14:33:39   BIC                          -1899.555
Sample:                    01-01-1948   HQIC                         -1910.531
                         - 10-01-2019                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0049      0.001      6.400      0.000       0.003       0.006
GDPC1.L1       0.3348      0.058      5.739      0.000       0.220       0.449
GDPC1.L2       0.1524      0.061      2.505      0.012       0.033       0.272
GDPC1.L3      -0.1154      0.058     -1.984      0.047      -0.229      -0.001
                                    Roots                                    
=============================================================================
                  Real          Imaginary           Modulus         Frequency
-----------------------------------------------------------------------------
AR.1           -2.0792           -0.0000j            2.0792           -0.5000
AR.2            1.6999           -1.1306j            2.0415           -0.0934
AR.3            1.6999           +1.1306j            2.0415            0.0934
-----------------------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>Start with a simple model where only the mean varies between the states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr_mod</span> <span class="o">=</span> <span class="n">MarkovAutoregression</span><span class="p">(</span><span class="n">gdpgr</span><span class="p">,</span> <span class="n">k_regimes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">switching_ar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">gdpgr_res</span> <span class="o">=</span> <span class="n">gdpgr_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdpgr_res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: -3.372851
         Iterations: 55
         Function evaluations: 72
         Gradient evaluations: 72
                         Markov Switching Model Results                         
================================================================================
Dep. Variable:                    GDPC1   No. Observations:                  288
Model:             MarkovAutoregression   Log Likelihood                 971.381
Date:                  Mon, 04 Apr 2022   AIC                          -1926.762
Time:                          14:33:46   BIC                          -1897.458
Sample:                      04-01-1947   HQIC                         -1915.019
                           - 10-01-2019                                         
Covariance Type:                 approx                                         
                             Regime 0 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0137      0.004     -3.599      0.000      -0.021      -0.006
                             Regime 1 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0083      0.001     10.922      0.000       0.007       0.010
                           Non-switching parameters                           
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
sigma2      5.678e-05   5.48e-06     10.361      0.000     4.6e-05    6.75e-05
ar.L1          0.3894      0.061      6.337      0.000       0.269       0.510
ar.L2          0.2269      0.078      2.904      0.004       0.074       0.380
ar.L3         -0.2136      0.070     -3.066      0.002      -0.350      -0.077
                         Regime transition parameters                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
p[0-&gt;0]     2.728e-10        nan        nan        nan         nan         nan
p[1-&gt;0]        0.0288      0.015      1.946      0.052      -0.000       0.058
==============================================================================

Warnings:
[1] Covariance matrix calculated using numerical (complex-step) differentiation.
</pre></div>
</div>
</div>
</div>
<p>Looking at the estimates of the transition probability, it’s clear that the optimizer didn’t find a good solution, which is why the standard errors on the probabilities are infinite. The likelihood function was likely not actually maximized. Let’s try again with a bit more control over the optmizer.</p>
<p>We should get a log-likelihood of about 974.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr_mod2</span> <span class="o">=</span> <span class="n">MarkovAutoregression</span><span class="p">(</span><span class="n">gdpgr</span><span class="p">,</span> <span class="n">k_regimes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">switching_ar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: this is advanced code. There is no need to understand it for this course.</span>
<span class="k">class</span> <span class="nc">ParamStore</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;A callback class for storing parameters from optimization algorithm&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">transform_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">loglik</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">loglike</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">param_names</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Log-Like&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loglik</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">param_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">param_history</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">param_history</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">param_history</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">param_history</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;iteration&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">param_history</span><span class="p">)</span>

<span class="n">param_store</span> <span class="o">=</span> <span class="n">ParamStore</span><span class="p">(</span><span class="n">gdpgr_mod2</span><span class="p">)</span>

<span class="n">gdpgr_res2</span> <span class="o">=</span> <span class="n">gdpgr_mod2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">em_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">search_reps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                            <span class="n">search_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">param_store</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdpgr_res2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: -3.382646
         Iterations: 33
         Function evaluations: 44
         Gradient evaluations: 44
                         Markov Switching Model Results                         
================================================================================
Dep. Variable:                    GDPC1   No. Observations:                  288
Model:             MarkovAutoregression   Log Likelihood                 974.202
Date:                  Mon, 04 Apr 2022   AIC                          -1932.404
Time:                          14:40:33   BIC                          -1903.100
Sample:                      04-01-1947   HQIC                         -1920.661
                           - 10-01-2019                                         
Covariance Type:                 approx                                         
                             Regime 0 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0123      0.003     -4.188      0.000      -0.018      -0.007
                             Regime 1 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0088      0.001     11.053      0.000       0.007       0.010
                           Non-switching parameters                           
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
sigma2      5.023e-05   5.24e-06      9.592      0.000       4e-05    6.05e-05
ar.L1          0.4432      0.066      6.766      0.000       0.315       0.572
ar.L2          0.2585      0.069      3.732      0.000       0.123       0.394
ar.L3         -0.2619      0.069     -3.780      0.000      -0.398      -0.126
                         Regime transition parameters                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
p[0-&gt;0]        0.2347      0.139      1.686      0.092      -0.038       0.507
p[1-&gt;0]        0.0410      0.018      2.312      0.021       0.006       0.076
==============================================================================

Warnings:
[1] Covariance matrix calculated using numerical (complex-step) differentiation.
</pre></div>
</div>
</div>
</div>
<p>The DataFrame below shows how the parameter values changed through the iteration steps.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_store</span><span class="o">.</span><span class="n">param_history</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p[0-&gt;0]</th>
      <th>p[1-&gt;0]</th>
      <th>const[0]</th>
      <th>const[1]</th>
      <th>sigma2</th>
      <th>ar.L1</th>
      <th>ar.L2</th>
      <th>ar.L3</th>
      <th>Log-Like</th>
    </tr>
    <tr>
      <th>iteration</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.141949</td>
      <td>0.003634</td>
      <td>-0.019675</td>
      <td>0.007889</td>
      <td>0.000065</td>
      <td>0.319231</td>
      <td>0.160570</td>
      <td>-0.125746</td>
      <td>966.953556</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.141949</td>
      <td>0.003634</td>
      <td>-0.019627</td>
      <td>0.007980</td>
      <td>0.000065</td>
      <td>0.319236</td>
      <td>0.160578</td>
      <td>-0.125749</td>
      <td>966.960999</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.141949</td>
      <td>0.003634</td>
      <td>-0.018581</td>
      <td>0.007992</td>
      <td>0.000065</td>
      <td>0.319323</td>
      <td>0.160745</td>
      <td>-0.125811</td>
      <td>967.019243</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.141944</td>
      <td>0.003637</td>
      <td>-0.018413</td>
      <td>0.007996</td>
      <td>0.000065</td>
      <td>0.322607</td>
      <td>0.166379</td>
      <td>-0.128245</td>
      <td>967.128967</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.141916</td>
      <td>0.003652</td>
      <td>-0.018094</td>
      <td>0.008007</td>
      <td>0.000065</td>
      <td>0.331382</td>
      <td>0.176732</td>
      <td>-0.135636</td>
      <td>967.318035</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.141802</td>
      <td>0.003712</td>
      <td>-0.017462</td>
      <td>0.008036</td>
      <td>0.000064</td>
      <td>0.354613</td>
      <td>0.197904</td>
      <td>-0.153138</td>
      <td>967.533524</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.141733</td>
      <td>0.003752</td>
      <td>-0.017519</td>
      <td>0.008044</td>
      <td>0.000064</td>
      <td>0.360845</td>
      <td>0.199685</td>
      <td>-0.155644</td>
      <td>967.558664</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.141580</td>
      <td>0.003843</td>
      <td>-0.017441</td>
      <td>0.008060</td>
      <td>0.000063</td>
      <td>0.369899</td>
      <td>0.199455</td>
      <td>-0.158584</td>
      <td>967.602192</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.141274</td>
      <td>0.004034</td>
      <td>-0.017399</td>
      <td>0.008081</td>
      <td>0.000063</td>
      <td>0.382529</td>
      <td>0.197697</td>
      <td>-0.162605</td>
      <td>967.679325</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.140688</td>
      <td>0.004436</td>
      <td>-0.017196</td>
      <td>0.008118</td>
      <td>0.000062</td>
      <td>0.401166</td>
      <td>0.194611</td>
      <td>-0.169499</td>
      <td>967.820004</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.135266</td>
      <td>0.010957</td>
      <td>-0.015642</td>
      <td>0.008453</td>
      <td>0.000056</td>
      <td>0.538557</td>
      <td>0.182673</td>
      <td>-0.232502</td>
      <td>968.930499</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.133753</td>
      <td>0.014514</td>
      <td>-0.015959</td>
      <td>0.008560</td>
      <td>0.000054</td>
      <td>0.565594</td>
      <td>0.193328</td>
      <td>-0.254751</td>
      <td>969.172699</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.132532</td>
      <td>0.021277</td>
      <td>-0.015119</td>
      <td>0.008690</td>
      <td>0.000054</td>
      <td>0.541356</td>
      <td>0.246992</td>
      <td>-0.288450</td>
      <td>971.071123</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.131364</td>
      <td>0.039098</td>
      <td>-0.012651</td>
      <td>0.008842</td>
      <td>0.000051</td>
      <td>0.475502</td>
      <td>0.307494</td>
      <td>-0.306057</td>
      <td>973.235082</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.132403</td>
      <td>0.035476</td>
      <td>-0.013847</td>
      <td>0.008766</td>
      <td>0.000051</td>
      <td>0.438855</td>
      <td>0.303666</td>
      <td>-0.286593</td>
      <td>973.509701</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.133105</td>
      <td>0.036541</td>
      <td>-0.012304</td>
      <td>0.008711</td>
      <td>0.000051</td>
      <td>0.418328</td>
      <td>0.283843</td>
      <td>-0.271192</td>
      <td>973.729242</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.132794</td>
      <td>0.042273</td>
      <td>-0.012530</td>
      <td>0.008711</td>
      <td>0.000051</td>
      <td>0.433379</td>
      <td>0.266601</td>
      <td>-0.266317</td>
      <td>973.854502</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.133379</td>
      <td>0.038986</td>
      <td>-0.012730</td>
      <td>0.008709</td>
      <td>0.000051</td>
      <td>0.438625</td>
      <td>0.257328</td>
      <td>-0.259794</td>
      <td>973.878844</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.133690</td>
      <td>0.039378</td>
      <td>-0.012674</td>
      <td>0.008714</td>
      <td>0.000051</td>
      <td>0.437335</td>
      <td>0.257950</td>
      <td>-0.259649</td>
      <td>973.882190</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.134589</td>
      <td>0.039837</td>
      <td>-0.012605</td>
      <td>0.008720</td>
      <td>0.000051</td>
      <td>0.436139</td>
      <td>0.258508</td>
      <td>-0.259297</td>
      <td>973.888081</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.136501</td>
      <td>0.040375</td>
      <td>-0.012525</td>
      <td>0.008728</td>
      <td>0.000050</td>
      <td>0.434882</td>
      <td>0.259143</td>
      <td>-0.258821</td>
      <td>973.898823</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.140353</td>
      <td>0.041079</td>
      <td>-0.012418</td>
      <td>0.008740</td>
      <td>0.000050</td>
      <td>0.433494</td>
      <td>0.259945</td>
      <td>-0.258250</td>
      <td>973.918519</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.148163</td>
      <td>0.042062</td>
      <td>-0.012270</td>
      <td>0.008758</td>
      <td>0.000050</td>
      <td>0.431984</td>
      <td>0.261010</td>
      <td>-0.257606</td>
      <td>973.953998</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.164531</td>
      <td>0.043458</td>
      <td>-0.012058</td>
      <td>0.008785</td>
      <td>0.000050</td>
      <td>0.430629</td>
      <td>0.262416</td>
      <td>-0.257014</td>
      <td>974.014182</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.200917</td>
      <td>0.045218</td>
      <td>-0.011782</td>
      <td>0.008828</td>
      <td>0.000049</td>
      <td>0.430646</td>
      <td>0.263966</td>
      <td>-0.256977</td>
      <td>974.096209</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.224821</td>
      <td>0.044871</td>
      <td>-0.011791</td>
      <td>0.008839</td>
      <td>0.000049</td>
      <td>0.433348</td>
      <td>0.263363</td>
      <td>-0.257988</td>
      <td>974.143252</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.240768</td>
      <td>0.042621</td>
      <td>-0.012061</td>
      <td>0.008818</td>
      <td>0.000050</td>
      <td>0.439081</td>
      <td>0.260560</td>
      <td>-0.260077</td>
      <td>974.190622</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.237074</td>
      <td>0.041048</td>
      <td>-0.012289</td>
      <td>0.008790</td>
      <td>0.000050</td>
      <td>0.442619</td>
      <td>0.258559</td>
      <td>-0.261449</td>
      <td>974.201734</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.234953</td>
      <td>0.040942</td>
      <td>-0.012313</td>
      <td>0.008786</td>
      <td>0.000050</td>
      <td>0.443189</td>
      <td>0.258475</td>
      <td>-0.261832</td>
      <td>974.201973</td>
    </tr>
    <tr>
      <th>30</th>
      <td>0.234696</td>
      <td>0.040950</td>
      <td>-0.012314</td>
      <td>0.008786</td>
      <td>0.000050</td>
      <td>0.443205</td>
      <td>0.258505</td>
      <td>-0.261904</td>
      <td>974.201976</td>
    </tr>
    <tr>
      <th>31</th>
      <td>0.234686</td>
      <td>0.040951</td>
      <td>-0.012314</td>
      <td>0.008786</td>
      <td>0.000050</td>
      <td>0.443204</td>
      <td>0.258507</td>
      <td>-0.261919</td>
      <td>974.201976</td>
    </tr>
    <tr>
      <th>32</th>
      <td>0.234690</td>
      <td>0.040951</td>
      <td>-0.012314</td>
      <td>0.008786</td>
      <td>0.000050</td>
      <td>0.443203</td>
      <td>0.258506</td>
      <td>-0.261923</td>
      <td>974.201976</td>
    </tr>
    <tr>
      <th>33</th>
      <td>0.234691</td>
      <td>0.040951</td>
      <td>-0.012314</td>
      <td>0.008786</td>
      <td>0.000050</td>
      <td>0.443203</td>
      <td>0.258506</td>
      <td>-0.261923</td>
      <td>974.201976</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We have two states, with constant terms <span class="math notranslate nohighlight">\(c_1 = -0.0123\)</span> and <span class="math notranslate nohighlight">\(c_2 = 0.0088\)</span>. Clearly, the first state is a low-growth (or “recession”) state and the second state is the high-growth state.</p>
<p>The transition probability matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
0.2347 &amp; 0.7653\\ 
0.0410 &amp; 0.9590 
\end{pmatrix},\end{split}\]</div>
<p>so if you’re in the high-growth state, there’s about a 96% chance you’ll stay there, but if you’re in the recession state there’s a 77% chance you’ll transition out of it. If you think about how long recessions last, this makes perfect sense.</p>
<p>The <em>expected duration</em> of the two states are given by <span class="math notranslate nohighlight">\(\frac{1}{0.7653}\)</span> and <span class="math notranslate nohighlight">\(\frac{1}{0.0410}.\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr_res2</span><span class="o">.</span><span class="n">expected_durations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1.30666198, 24.41921741])
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the filtered probabilities of state 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr_res2</span><span class="o">.</span><span class="n">filtered_marginal_probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;DATE&#39;&gt;
</pre></div>
</div>
<img alt="_images/07b Markov switching model_27_1.png" src="_images/07b Markov switching model_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get NBER recessions data</span>
<span class="n">usrec</span> <span class="o">=</span> <span class="n">pdr</span><span class="o">.</span><span class="n">get_data_fred</span><span class="p">(</span><span class="s1">&#39;USREC&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1947</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gdpgr_res2</span><span class="o">.</span><span class="n">filtered_marginal_probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">usrec</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">usrec</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Filtered probability of recession&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gdpgr_res2</span><span class="o">.</span><span class="n">smoothed_marginal_probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">usrec</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">usrec</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Smoothed probability of recession&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gdpgr</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gdpgr</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07b Markov switching model_29_0.png" src="_images/07b Markov switching model_29_0.png" />
</div>
</div>
</section>
<section id="the-great-moderation">
<h2>The Great Moderation<a class="headerlink" href="#the-great-moderation" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">gdpgr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="s1">&#39;2019&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="n">gdpgr</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;GDP&#39;</span><span class="p">,</span> <span class="s1">&#39;Std.Dev.&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f8e96b51310&gt;
</pre></div>
</div>
<img alt="_images/07b Markov switching model_31_1.png" src="_images/07b Markov switching model_31_1.png" />
</div>
</div>
<p>The volatility in the series after 1985 is about half of what it is before that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr</span><span class="p">[:</span><span class="s1">&#39;1985&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GDPC1    0.011468
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdpgr</span><span class="p">[</span><span class="s1">&#39;1985&#39;</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GDPC1    0.005604
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This decline in the volatility of GDP growth is known as the <a class="reference external" href="https://en.wikipedia.org/wiki/Great_Moderation">Great Moderation</a>.</p>
<p>We can estimate a Markov Switching Model where the autoregressive structure changes depending on which state we are in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod_gdpgr2</span> <span class="o">=</span> <span class="n">MarkovAutoregression</span><span class="p">(</span><span class="n">gdpgr</span><span class="p">,</span> <span class="n">k_regimes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                  <span class="n">switching_ar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                  <span class="n">switching_variance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res_gdpgr2</span> <span class="o">=</span> <span class="n">mod_gdpgr2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: -3.486913
         Iterations: 66
         Function evaluations: 87
         Gradient evaluations: 87
                         Markov Switching Model Results                         
================================================================================
Dep. Variable:                    GDPC1   No. Observations:                  288
Model:             MarkovAutoregression   Log Likelihood                1004.231
Date:                  Mon, 04 Apr 2022   AIC                          -1984.462
Time:                          14:46:15   BIC                          -1940.506
Sample:                      04-01-1947   HQIC                         -1966.847
                           - 10-01-2019                                         
Covariance Type:                 approx                                         
                             Regime 0 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0081      0.001      6.077      0.000       0.005       0.011
sigma2         0.0001   1.43e-05      8.447      0.000    9.27e-05       0.000
ar.L1          0.3299      0.084      3.927      0.000       0.165       0.495
ar.L2          0.1303      0.087      1.500      0.134      -0.040       0.300
ar.L3         -0.1361      0.084     -1.622      0.105      -0.301       0.028
                             Regime 1 parameters                              
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0072      0.001     10.409      0.000       0.006       0.009
sigma2      1.959e-05    2.5e-06      7.834      0.000    1.47e-05    2.45e-05
ar.L1          0.2281      0.097      2.354      0.019       0.038       0.418
ar.L2          0.2631      0.080      3.293      0.001       0.107       0.420
ar.L3         -0.0620      0.077     -0.804      0.421      -0.213       0.089
                         Regime transition parameters                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
p[0-&gt;0]        0.9873      0.010     98.450      0.000       0.968       1.007
p[1-&gt;0]        0.0130      0.010      1.269      0.204      -0.007       0.033
==============================================================================

Warnings:
[1] Covariance matrix calculated using numerical (complex-step) differentiation.
</pre></div>
</div>
</div>
</div>
<p>The main difference in the models is the huge difference in the estimate of the volatility parameters in each regime:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sigma2[0]&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;sigma2[1]&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.159718612641327
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">smoothed_marginal_probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07b Markov switching model_39_0.png" src="_images/07b Markov switching model_39_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span> <span class="k">as</span> <span class="n">st</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ACF&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07b Markov switching model_41_0.png" src="_images/07b Markov switching model_41_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acf</span><span class="p">,</span> <span class="n">qstats</span><span class="p">,</span> <span class="n">pvals</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">res_gdpgr2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">qstat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pvals</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.95379976, 0.99555186, 0.83071072, 0.82418322, 0.45177622,
       0.54606175, 0.55594421, 0.5580098 , 0.61572801, 0.4633059 ,
       0.51778368, 0.23883035])
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="07aa%20Applications.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Applications</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08%20Volatility%20modeling.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Volatility modeling</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    <div class="extra_footer">
      &copy; 2023 <a href="https://stoffprof.github.io">Noah Stoffman</a>. Version 0.23.03.
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>